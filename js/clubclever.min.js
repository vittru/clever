
jQuery.expr[":"].icontains=function(c,d,b){return jQuery(c).text().toUpperCase().indexOf(b[3].toUpperCase())>=0};$(document.body).on("hidden.bs.modal",function(){$("#single-product").removeData("bs.modal")});var nameAsc=true;var priceAsc=true;function filter(){$("ul.aa-product-catg li.good").show();if($("div.tab-pane.active #showAvailable").is(":checked")){$("div.tab-pane.active li.good").has(".aa-sold-out").hide()}if($("div.tab-pane.active #showSale").is(":checked")){$("div.tab-pane.active li.good").not(":has('.aa-sale')").hide()}var a=$("#showWord").val().trim();if(a){$("div.tab-pane.active li.good").not(":icontains('"+a+"')").hide()}}$("#nameSortButton").on("click",function(){var a=$("ul.aa-product-catg li.good").sort(function(d,c){return(nameAsc==($(d).find(".aa-product-title").text()>$(c).find(".aa-product-title").text()))?1:-1});nameAsc=nameAsc?false:true;$("div.aa-sort-form").find(".sortAsc").hide();$("div.aa-sort-form").find(".sortDesc").hide();if(nameAsc){$(this).find(".sortAsc").show()}else{$(this).find(".sortDesc").show()}$("ul.aa-product-catg").html(a)});$("#priceSortButton").on("click",function(){var a=$("ul.aa-product-catg li.good").sort(function(d,c){return(priceAsc==(parseInt($(d).find(".aa-product-price").attr("value"))>parseInt($(c).find(".aa-product-price").attr("value"))))?1:-1});priceAsc=priceAsc?false:true;$("div.aa-sort-form").find(".sortAsc").hide();$("div.aa-sort-form").find(".sortDesc").hide();if(priceAsc){$(this).find(".sortAsc").show()}else{$(this).find(".sortDesc").show()}$("ul.aa-product-catg").html(a)});$("#showWord").on("change keyup paste input",filter_goods);$(document).on("click",".aa-remove-product",function(){var b=$(this).attr("id"),a=$(this).attr("value");$.ajax({type:"GET",url:"/cart/remove",data:"id="+b+"&sid="+a,dataType:"html",success:function(){$(".cart-view-table").load(location.href+" .cart-view-table>*","");$("#cartbox").load(location.href+" #cartbox>*","")}})});$(document).on("change",".aa-cart-quantity",function(){var c=$(this).parent().parent();var d=$(c).find(".aa-remove-product").attr("id"),a=$(c).find(".aa-remove-product").attr("value"),b=$(this).val();$.ajax({type:"GET",url:"/cart/update",data:"id="+d+"&sid="+a+"&c="+b,dataType:"html",success:function(){$(".cart-view-table").load(location.href+" .cart-view-table>*","");$("#cartbox").load(location.href+" #cartbox>*","")}})});$(document).on("click",".aa-add-card-btn",function(){$(this).text("Добавлено");var b=window.location.hostname;if(b!="localhost"){yaCounter44412517.reachGoal("INCART")}var c={};c.goodId=$(this).attr("id");c.sizeId=$(this).attr("value");c.count=1;c.price=$(this).attr("data-price");c.sale=$(this).attr("data-sale");var a=[c];$.ajax({type:"POST",url:"/cart/add",data:{data:JSON.stringify(a)},success:function(){$("#cartbox").load(location.href+" #cartbox>*","")}})});$(document).on("mouseleave","li.good",function(){$(this).parent().find(".aa-add-card-btn").html('<span class="fa fa-shopping-cart"></span>В корзину')});$(".panel-heading a").on("click",function(a){if($(this).parents(".panel").children(".panel-collapse").hasClass("in")){a.stopPropagation()}a.preventDefault()});$("#order-form").submit(function(b){var a=true;if($("#discount").is(":hidden")){$("#promo").val("");$("#bonus").val("")}if(!$("#promo-error").is(":hidden")||$("#promo").is(":hidden")){$("#promo").val("")}if(!$("#bonus-error").is(":hidden")||$("#bonus").is(":hidden")){$("#bonus").val("")}$("input.required").each(function(){if(!$(this).is(":hidden")&&!$(this).val().trim()){a=false}});$("textarea.required").each(function(){if(!$(this).is(":hidden")&&!$(this).val().trim()){a=false}});if(!$("#branch").is(":hidden")&&!$("#branch").val()){a=false}if(!a){b.preventDefault();$("#order-error").show()}else{$("input.order-form:hidden").attr("disabled",true);$("textarea.order-form:hidden").attr("disabled",true);$("#branch:hidden").attr("disabled",true)}});$(document).on("click",".aa-search-box .dropdown-lg",function(a){a.stopPropagation()});$(document).on("click",".aa-search-box #search-text",function(a){a.stopPropagation()});function applyDiscount(b,c){JSON.parse(b,function(d,a){var e=true;if(d==="error"){if(a){c.text(a);c.show();e=false}else{c.hide()}}if(!e){$("#discount").hide()}else{if(d==="discount"){if(a){$("#discount").find("#sum").text(a+" руб.");$("#discount").show()}else{$("#discount").hide()}}if(d==="percent"&&a){$("#discount").find("#sum").text(a+" %");$("#discount").show()}}if(d==="total"){$("#total").text(a+" руб.");if(a<$("#freeDelivery").text()){$("#amount-left").text($("#freeDelivery").text()-a);$("#delivery-info").show()}else{$("#delivery-info").hide()}}})}function checkPromo(a){$.ajax({type:"GET",url:"/buy/checkpromo",data:"promo="+a,dataType:"html",success:function(b){applyDiscount(b,$("#promo-error"))}});if(!a){$("#discount").hide();$("#promo-error").hide()}}$(document).on("change","#promo",function(){checkPromo($(this).val().trim())});$("#promo").on("keyup",function(b){var a=b.keyCode||b.which;if(a===13){b.preventDefault();checkPromo($(this).val().trim());return false}});$("#order-form").on("keyup keypress",function(b){var a=b.keyCode||b.which;if(a===13){b.preventDefault();return false}});$("#change-order-status").on("click",function(){var a=$("[name='id']").val();var b=$("#status").val();$.ajax({type:"GET",url:"/account/updateorder",data:"order="+a+"&status="+b,dataType:"html"});location.reload()});$("#search-text").on("focus",function(){$("#search-dropdown").addClass("open")});$(document).on("click",function(a){if(!$(a.target).closest("#search-dropdown").length){$("#search-dropdown").removeClass("open")}});$("#panel-bonus").on("click",function(){if(!$(this).parents(".panel").children(".panel-collapse").hasClass("in")){$("#promo").val("");checkPromo($("#promo").val().trim())}});$("#use-bonus").on("click",function(){$.ajax({type:"GET",url:"/buy/checkbonus",data:"bonus="+$("#bonus").val(),dataType:"html",success:function(b){applyDiscount(b,$("#bonus-error"))}});$(this).blur()});$(".SlectBox").on("change",filter_goods);function filter_goods(){$("#empty-catg").hide();$("ul.aa-product-catg li.good").show();$(".SlectBox").each(function(){var b=new Array();$(this).find("option:selected").each(function(){b.push($(this)[0].id)});if(b.length>0){$("ul.aa-product-catg li.good").each(function(){var d=false;var c=0;while(!d&&c<b.length){if($(this).has("div."+b[c]).length){d=true}else{c++}}if(!d){$(this).hide()}})}});var a=$("#showWord").val().trim();if(a){$("ul.aa-product-catg li.good").not(":icontains('"+a+"')").hide()}if($("ul.aa-product-catg").children(":visible").length==0){$("#empty-catg").show()}}$("input[name=payment]").on("change",function(){if(this.value=="card"){$("#make_order").val("Заказать и оплатить")}else{$("#make_order").val("Заказать")}});$(document).ready(function(){$(".SlectBox").SumoSelect({captionFormat:"{0} выбрано",captionFormatAllSelected:"Все {0} выбраны"});$("#city").editableSelect()});$("#subscribe-form").submit(function(b){b.preventDefault();var a=$("#subscribe-email").val();$.ajax({type:"POST",url:"subscribe",data:"userEmail="+a,dataType:"html",dataFilter:function(c){return $(c).filter("#error").html()},success:function(c){if(c==null){window.location.reload()}else{$("#subscribe-error").show();$("#subscribe-error").html(c)}}})});$("#subscribe-email").focus(function(){$("#subscribe-error").hide()});$("#sendTestEmail").click(function(){var a=$("#description").summernote("code");$("#text").val(a);$.post("/mailout/testEmail",{header:$("#header").val(),text:$("#text").val(),email:$("#testEmail").val()},function(c,b){alert(c)})});$(document).on("click",".aa-emailme-btn",function(){$("#emailMe").modal("show");$("#emailGoodId").val($(this).offsetParent().find(".aa-product-img").attr("href").substring(13,20))});$("input[name=emailMeRAddr]").on("change",function(){if(this.value==="phone"){$("#emailMePhone").removeAttr("disabled")}else{$("#emailMePhone").attr({disabled:"disabled"})}});$("#emailMeSubmit").click(function(){var a;if($("#emailMeAddr").length){a=$("#emailMeAddr").val().trim()}else{if($("input[name=emailMeRAddr]:checked").val()==="email"){a=$("label[for=emailMeREmail]").text().trim()}else{if($("#emailMePhone").length){a=$("#emailMePhone").val().trim()}else{a=$("label[for=emailMeRPhone]").text().trim()}}}if($("#pId").length){goodEmail=$("#pId").text()}else{goodEmail=$("#emailGoodId").val()}if(a){$.ajax({type:"GET",url:"/showgood/emailMe",data:{address:a,good:goodEmail},success:function(){location.reload()}})}else{if($("#emailMeAddr").length){$("#emailMeAddr").addClass("error")}if($("#emailMePhone").length&&!$("#emailMePhone").attr("disabled")){$("#emailMePhone").addClass("error")}}});$("[data-toggle=popover]").popover({trigger:"click"});$("[data-toggle=popover]").on("click",function(a){$("[data-toggle=popover]").not(this).popover("hide")});$(".aa-quick-order-btn").on("click",function(){$("#quickOrderCount").val(1);$("#quickOrderError").hide();if($(".image-good").length){$("#quickOrderImage").attr("src",$(".image-good").attr("src"));$("#quickOrderGood").html($(".modal-title").html())}else{$("#quickOrderImage").attr("src",$(this).offsetParent().find("img").attr("src"));$("#quickOrderGood").html($(this).offsetParent().find("div.aa-product-title a").html());$("#quickOrderQuantity").html("1");$("#quickOrderPrice").html($(this).offsetParent().find(".aa-product-price").html())}});