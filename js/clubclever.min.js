
jQuery.expr[":"].icontains=function(c,d,b){return jQuery(c).text().toUpperCase().indexOf(b[3].toUpperCase())>=0};$(document.body).on("hidden.bs.modal",function(){$("#single-product").removeData("bs.modal")});var nameAsc=true;var priceAsc=true;function filter(){$("ul.aa-product-catg li.good").show();if($("div.tab-pane.active #showAvailable").is(":checked")){$("div.tab-pane.active li.good").has(".aa-sold-out").hide()}if($("div.tab-pane.active #showSale").is(":checked")){$("div.tab-pane.active li.good").not(":has('.aa-sale')").hide()}var b=$("#showWord").val().trim();if(b){$("div.tab-pane.active li.good").not(":icontains('"+b+"')").hide()}}$("#nameSortButton").on("click",function(){var b=$("ul.aa-product-catg li.good").sort(function(d,c){return(nameAsc==($(d).find(".aa-product-title").text()>$(c).find(".aa-product-title").text()))?1:-1});nameAsc=nameAsc?false:true;$("div.aa-product-catg-head").find(".sortAsc").hide();$("div.aa-product-catg-head").find(".sortDesc").hide();if(nameAsc){$(this).find(".sortAsc").show()}else{$(this).find(".sortDesc").show()}$("ul.aa-product-catg").html(b)});$("#priceSortButton").on("click",function(){var b=$("ul.aa-product-catg li.good").sort(function(d,c){return(priceAsc==(parseInt($(d).find(".aa-product-price").attr("value"))>parseInt($(c).find(".aa-product-price").attr("value"))))?1:-1});priceAsc=priceAsc?false:true;$("div.aa-product-catg-head").find(".sortAsc").hide();$("div.aa-product-catg-head").find(".sortDesc").hide();if(priceAsc){$(this).find(".sortAsc").show()}else{$(this).find(".sortDesc").show()}$("ul.aa-product-catg").html(b)});$("#showWord").on("change keyup paste input",filter_goods);$(document).on("click",".aa-remove-product",function(){var c=$(this).attr("id"),b=$(this).attr("value");$.ajax({type:"GET",url:"/cart/remove",data:"id="+c+"&sid="+b,dataType:"html",success:function(){$(".cart-view-table").load(location.href+" .cart-view-table>*","");$("#cartbox").load(location.href+" #cartbox>*","")}})});$(document).on("change",".aa-cart-quantity",function(){var d=$(this).parent().parent();var e=$(d).find(".aa-remove-product").attr("id"),b=$(d).find(".aa-remove-product").attr("value"),c=$(this).val();$.ajax({type:"GET",url:"/cart/update",data:"id="+e+"&sid="+b+"&c="+c,dataType:"html",success:function(){$(".cart-view-table").load(location.href+" .cart-view-table>*","");$("#cartbox").load(location.href+" #cartbox>*","")}})});$(document).on("click",".aa-add-card-btn",function(){$(this).text("Добавлено");var c={};c.goodId=$(this).attr("id");c.sizeId=$(this).attr("value");c.count=1;c.price=$(this).attr("data-price");c.sale=$(this).attr("data-sale");var b=[c];$.ajax({type:"POST",url:"/cart/add",data:{data:JSON.stringify(b)},success:function(){$("#cartbox").load(location.href+" #cartbox>*","")}})});$(document).on("mouseleave","li.good",function(){$(this).parent().find(".aa-add-card-btn").html('<span class="fa fa-shopping-cart"></span>В корзину')});$(".panel-heading a").on("click",function(b){if($(this).parents(".panel").children(".panel-collapse").hasClass("in")){b.stopPropagation()}b.preventDefault()});$("#order-form").submit(function(c){var b=true;if($("#discount").is(":hidden")){$("#promo").val("");$("#bonus").val("")}if(!$("#promo-error").is(":hidden")||$("#promo").is(":hidden")){$("#promo").val("")}if(!$("#bonus-error").is(":hidden")||$("#bonus").is(":hidden")){$("#bonus").val("")}$("input.required").each(function(){if(!$(this).is(":hidden")&&!$(this).val().trim()){b=false}});$("textarea.required").each(function(){if(!$(this).is(":hidden")&&!$(this).val().trim()){b=false}});if(!$("#branch").is(":hidden")&&!$("#branch").val()){b=false}if(!b){c.preventDefault();$("#order-error").show()}else{$("input.order-form:hidden").attr("disabled",true);$("textarea.order-form:hidden").attr("disabled",true);$("#branch:hidden").attr("disabled",true)}});$(document).on("click",".aa-search-box .dropdown-lg",function(b){b.stopPropagation()});$(document).on("click",".aa-search-box #search-text",function(b){b.stopPropagation()});function applyDiscount(b,c){JSON.parse(b,function(e,d){var f=true;if(e==="error"){if(d){c.text(d);c.show();f=false}else{c.hide()}}if(!f){$("#discount").hide()}else{if(e==="discount"){if(d){$("#discount").find("#sum").text(d+" руб.");$("#discount").show()}else{$("#discount").hide()}}if(e==="percent"&&d){$("#discount").find("#sum").text(d+" %");$("#discount").show()}}if(e==="total"){$("#total").text(d+" руб.");if(d<$("#freeDelivery").text()){$("#amount-left").text($("#freeDelivery").text()-d);$("#delivery-info").show()}else{$("#delivery-info").hide()}}})}function checkPromo(b){$.ajax({type:"GET",url:"/buy/checkpromo",data:"promo="+b,dataType:"html",success:function(c){applyDiscount(c,$("#promo-error"))}});if(!b){$("#discount").hide();$("#promo-error").hide()}}$(document).on("change","#promo",function(){checkPromo($(this).val().trim())});$("#promo").on("keyup",function(c){var b=c.keyCode||c.which;if(b===13){c.preventDefault();checkPromo($(this).val().trim());return false}});$("#order-form").on("keyup keypress",function(c){var b=c.keyCode||c.which;if(b===13){c.preventDefault();return false}});$("#change-order-status").on("click",function(){var b=$("[name='id']").val();var c=$("#status").val();$.ajax({type:"GET",url:"/account/updateorder",data:"order="+b+"&status="+c,dataType:"html"});location.reload()});$("#search-text").on("focus",function(){$("#search-dropdown").addClass("open")});$(document).on("click",function(b){if(!$(b.target).closest("#search-dropdown").length){$("#search-dropdown").removeClass("open")}});$("#panel-bonus").on("click",function(){if(!$(this).parents(".panel").children(".panel-collapse").hasClass("in")){$("#promo").val("");checkPromo($("#promo").val().trim())}});$("#use-bonus").on("click",function(){$.ajax({type:"GET",url:"/buy/checkbonus",data:"bonus="+$("#bonus").val(),dataType:"html",success:function(b){applyDiscount(b,$("#bonus-error"))}});$(this).blur()});$(".SlectBox").on("change",filter_goods);function filter_goods(){$("#empty-catg").hide();$("ul.aa-product-catg li.good").show();$(".SlectBox").each(function(){var c=new Array();$(this).find("option:selected").each(function(){c.push($(this)[0].id)});if(c.length>0){$("ul.aa-product-catg li.good").each(function(){var e=false;var d=0;while(!e&&d<c.length){if($(this).has("div."+c[d]).length){e=true}else{d++}}if(!e){$(this).hide()}})}});var b=$("#showWord").val().trim();if(b){$("ul.aa-product-catg li.good").not(":icontains('"+b+"')").hide()}if($("ul.aa-product-catg").children(":visible").length==0){$("#empty-catg").show()}}$("input[name=payment]").on("change",function(){if(this.value=="card"){$("#make_order").val("Заказать и оплатить")}else{$("#make_order").val("Заказать")}});$(document).ready(function(){$(".SlectBox").SumoSelect({captionFormat:"{0} выбрано",captionFormatAllSelected:"Все {0} выбраны"});$("#city").editableSelect()});$("#subscribe-form").submit(function(c){c.preventDefault();var b=$("#subscribe-email").val();$.ajax({type:"POST",url:"subscribe",data:"userEmail="+b,dataType:"html",dataFilter:function(d){return $(d).filter("#error").html()},success:function(d){if(d==null){window.location.reload()}else{$("#subscribe-error").show();$("#subscribe-error").html(d)}}})});$("#subscribe-email").focus(function(){$("#subscribe-error").hide()});$("#sendTestEmail").click(function(){var b=$("#description").summernote("code");$("#text").val(b);$.post("/mailout/testEmail",{header:$("#header").val(),text:$("#text").val(),email:$("#testEmail").val()},function(d,c){alert(d)})});$(document).on("click",".aa-emailme-btn",function(){$("#emailMe").modal("show");$("#emailGoodId").val($(this).offsetParent().find(".aa-product-img").attr("href").substring(13,20))});$("input[name=emailMeRAddr]").on("change",function(){if(this.value==="phone"){$("#emailMePhone").removeAttr("disabled")}else{$("#emailMePhone").attr({disabled:"disabled"})}});$("#emailMeSubmit").click(function(){var b;if($("#emailMeAddr").length){b=$("#emailMeAddr").val().trim()}else{if($("input[name=emailMeRAddr]:checked").val()==="email"){b=$("label[for=emailMeREmail]").text().trim()}else{if($("#emailMePhone").length){b=$("#emailMePhone").val().trim()}else{b=$("label[for=emailMeRPhone]").text().trim()}}}if($("#pId").length){goodEmail=$("#pId").text()}else{goodEmail=$("#emailGoodId").val()}if(b){$.ajax({type:"GET",url:"/showgood/emailMe",data:{address:b,good:goodEmail},success:function(){location.reload()}})}else{if($("#emailMeAddr").length){$("#emailMeAddr").addClass("error")}if($("#emailMePhone").length&&!$("#emailMePhone").attr("disabled")){$("#emailMePhone").addClass("error")}}});$("[data-toggle=popover]").popover({trigger:"click"});$("[data-toggle=popover]").on("click",function(b){$("[data-toggle=popover]").not(this).popover("hide")});$(".aa-quick-order-btn").on("click",function(){$("#quickOrderCount").val(1);$("#quickOrderError").hide();if($(".image-good").length){$("#quickOrderImage").attr("src",$(".image-good").attr("src"));$("#quickOrderGood").html($(".modal-title").html())}else{$("#quickOrderImage").attr("src",$(this).offsetParent().find("img").attr("src"));$("#quickOrderGood").html($(this).offsetParent().find("div.aa-product-title a").html());$("#quickOrderQuantity").html("1");$("#quickOrderPrice").html($(this).offsetParent().find(".aa-product-price").html())}});$("#reviewSubmit").click(function a(){var c=0;$(".clovers").each(function(){if($(this).is(":checked")){c=$(this).val()}});var b=new Date().toJSON().slice(0,10);if($("#reviewDate").length){b=$("#reviewDate").val()}$.ajax({type:"POST",url:"/showgood/review",data:{author:$("#reviewAuthor").val(),text:$("#reviewText").val(),goodId:$("#pId").text(),reviewId:$("#reviewId").val(),reviewDate:b,clovers:c},success:function(d){if(!isNaN(d)){window.location.hash="#reviews";location.reload()}else{$("#reviewError").show();$("#reviewError").html(d)}}})});$(".deleteReview").click(function a(){if(confirm("Удалить отзыв?")){$.ajax({type:"POST",url:"/showgood/deletereview",data:{reviewId:$(this).attr("data-review")}});window.location.hash="#reviews";location.reload()}});$(".editReview").click(function a(){$("#reviewId").val($(this).attr("data-review"));$("#reviewAuthor").val($(this).attr("data-author"));$("#reviewText").val($(this).attr("data-text"));$("#reviewDate").val($(this).attr("data-date"));var b=$(this).attr("data-clovers");if(b){$("#"+b+"-clovers").prop("checked",true)}});$(".order-link").click(function a(){$.ajax({type:"GET",url:"/account/orderlink",data:"id="+$(this).attr("data-id"),success:function(b){if(b){alert(window.location.host+b)}else{alert("Произошла ошибка!")}}})});